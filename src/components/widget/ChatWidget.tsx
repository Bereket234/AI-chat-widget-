import { useState } from "react";
import type { ReactNode } from "react";
import "./ChatWidget.css";
import logo from "../../assets/logo.png";

const SparkleIcon = () => (
  <svg
    xmlns="http://www.w3.org/2000/svg"
    width="42"
    height="42"
    viewBox="0 0 42 42"
    fill="none"
  >
    <g clipPath="url(#clip0_3573_30405)">
      <circle cx="21" cy="21" r="21" fill="#FBBF24" />
      <g clipPath="url(#clip1_3573_30405)">
        <path
          d="M20.9225 18.5422C21.1081 17.9853 21.8945 17.9853 22.0801 18.5422L23.1686 21.8109C23.4082 22.5294 23.8118 23.1823 24.3475 23.7177C24.8833 24.2532 25.5363 24.6565 26.255 24.8957L29.522 25.9841C30.0789 26.1697 30.0789 26.9561 29.522 27.1417L26.2533 28.2302C25.5348 28.4697 24.8819 28.8734 24.3465 29.4091C23.8111 29.9448 23.4078 30.5979 23.1686 31.3166L22.0801 34.5836C22.0401 34.7055 21.9626 34.8117 21.8587 34.887C21.7547 34.9623 21.6297 35.0028 21.5013 35.0028C21.373 35.0028 21.2479 34.9623 21.144 34.887C21.04 34.8117 20.9625 34.7055 20.9225 34.5836L19.8341 31.3149C19.5947 30.5965 19.1913 29.9438 18.6559 29.4084C18.1204 28.873 17.4677 28.4696 16.7493 28.2302L13.4806 27.1417C13.3587 27.1017 13.2525 27.0242 13.1772 26.9202C13.1019 26.8163 13.0614 26.6912 13.0614 26.5629C13.0614 26.4346 13.1019 26.3095 13.1772 26.2056C13.2525 26.1016 13.3587 26.0241 13.4806 25.9841L16.7493 24.8957C17.4677 24.6562 18.1204 24.2529 18.6559 23.7174C19.1913 23.182 19.5947 22.5293 19.8341 21.8109L20.9225 18.5422ZM14.4037 9.93765C14.4279 9.86457 14.4745 9.80098 14.5369 9.75591C14.5993 9.71083 14.6743 9.68657 14.7513 9.68657C14.8283 9.68657 14.9033 9.71083 14.9657 9.75591C15.0281 9.80098 15.0748 9.86457 15.099 9.93765L15.752 11.8985C16.044 12.7727 16.7291 13.4578 17.6032 13.7497L19.5641 14.4028C19.6372 14.427 19.7008 14.4736 19.7458 14.536C19.7909 14.5984 19.8152 14.6734 19.8152 14.7504C19.8152 14.8274 19.7909 14.9024 19.7458 14.9648C19.7008 15.0272 19.6372 15.0738 19.5641 15.098L17.6032 15.7511C17.1721 15.8947 16.7804 16.1368 16.459 16.4581C16.1377 16.7794 15.8956 17.1712 15.752 17.6023L15.099 19.5632C15.0748 19.6362 15.0281 19.6998 14.9657 19.7449C14.9033 19.79 14.8283 19.8142 14.7513 19.8142C14.6743 19.8142 14.5993 19.79 14.5369 19.7449C14.4745 19.6998 14.4279 19.6362 14.4037 19.5632L13.7506 17.6023C13.607 17.1712 13.3649 16.7794 13.0436 16.4581C12.7223 16.1368 12.3306 15.8947 11.8995 15.7511L9.93858 15.098C9.8655 15.0738 9.80191 15.0272 9.75683 14.9648C9.71176 14.9024 9.6875 14.8274 9.6875 14.7504C9.6875 14.6734 9.71176 14.5984 9.75683 14.536C9.80191 14.4736 9.8655 14.427 9.93858 14.4028L11.8995 13.7497C12.3306 13.6061 12.7223 13.364 13.0436 13.0427C13.3649 12.7214 13.607 12.3296 13.7506 11.8985L14.4037 9.93765ZM26.3326 8.16747C26.3493 8.11942 26.3805 8.07775 26.4219 8.04826C26.4634 8.01878 26.513 8.00293 26.5638 8.00293C26.6147 8.00293 26.6643 8.01878 26.7057 8.04826C26.7471 8.07775 26.7784 8.11942 26.795 8.16747L27.2304 9.47359C27.4245 10.0575 27.8818 10.5148 28.4656 10.7088L29.7718 11.1442C29.8198 11.1609 29.8615 11.1921 29.891 11.2335C29.9205 11.275 29.9363 11.3245 29.9363 11.3754C29.9363 11.4263 29.9205 11.4758 29.891 11.5173C29.8615 11.5587 29.8198 11.5899 29.7718 11.6066L28.4656 12.042C28.1779 12.1377 27.9164 12.2992 27.702 12.5136C27.4876 12.728 27.3261 12.9895 27.2304 13.2772L26.795 14.5833C26.7784 14.6314 26.7471 14.6731 26.7057 14.7025C26.6643 14.732 26.6147 14.7479 26.5638 14.7479C26.513 14.7479 26.4634 14.732 26.4219 14.7025C26.3805 14.6731 26.3493 14.6314 26.3326 14.5833L25.8973 13.2772C25.8015 12.9895 25.6401 12.728 25.4256 12.5136C25.2112 12.2992 24.9498 12.1377 24.662 12.042L23.3576 11.6066C23.3095 11.5899 23.2679 11.5587 23.2384 11.5173C23.2089 11.4758 23.193 11.4263 23.193 11.3754C23.193 11.3245 23.2089 11.275 23.2384 11.2335C23.2679 11.1921 23.3095 11.1609 23.3576 11.1442L24.6637 10.7088C25.2476 10.5148 25.7049 10.0575 25.899 9.47359L26.3326 8.16915V8.16747Z"
          fill="#332219"
        />
      </g>
    </g>
    <defs>
      <clipPath id="clip0_3573_30405">
        <rect width="42" height="42" fill="white" />
      </clipPath>
      <clipPath id="clip1_3573_30405">
        <rect width="27" height="27" fill="white" transform="translate(8 8)" />
      </clipPath>
    </defs>
  </svg>
);

interface ChatWidgetProps {
  children: ReactNode;
}

const ChatWidget: React.FC<ChatWidgetProps> = ({ children }) => {
  const [open, setOpen] = useState(false);

  const handleClose = () => {
    setOpen(false);
  };

  return (
    <div className={`chat-widget-container ${open ? "open" : ""}`}>
      <button
        className={`chat-widget-btn ${open ? "open" : ""}`}
        onClick={() => setOpen((v) => !v)}
        aria-label={open ? "Close chat" : "Open chat"}
        style={{ width: 42, height: 42 }}
      >
        <span className="icon-wrapper">
          <SparkleIcon />
        </span>
      </button>

      {open && (
        <div className="chat-widget-overlay">
          <div className="chat-widget">
            <div className="main-chat-header">
              <h3>How can I help?</h3>
              <button className="close-button" onClick={handleClose}>
                <svg width="20" height="20" viewBox="0 0 20 20" fill="none">
                  <path
                    d="M15 5L5 15M5 5L15 15"
                    stroke="currentColor"
                    strokeWidth="2"
                    strokeLinecap="round"
                  />
                </svg>
              </button>
            </div>

            <div className="chat-content">{children}</div>

            <div className="chat-footer">
              <span>Powered by</span>
              <strong>
                <img src={logo} alt="Outpost" />
              </strong>
            </div>
          </div>
        </div>
      )}
    </div>
  );
};

export default ChatWidget;
